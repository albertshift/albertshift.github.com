---
layout: post
title: Installation of the Cassandra by DELL Crowbar
---

h1. {{ page.title }}

p(meta). 19 Oct 2012 - Moscow

This is an installation and configuration guide for the Apache Cassandra by using DELL Crowbar unboxer.

DELL Crowbar is an opensource framework that has plugins called barclamps that installs and configures software on physical machines. I have written the "barclamp_cassandra":https://github.com/shvid/barclamp-cassandra for Apache Cassandra installation and configuration through Crowbar. Let's consider steps for quick installation of the Cassandra on your environment.

**1. Crowbar ISO generation**

First step is the ISO generation that will contains all barclamps included in this process. You could manage barclamps as sub modules for Crowbar and add/remove some of them. This ISO will cache all packages and files needs for barclamps and all machines will install OS and packages from this ISO. 
In order to start building ISO go to this "page":https://github.com/dellcloudedge/crowbar/wiki/Build-Crowbar.ISO that describes how to start this process, and then add barclamp_cassandra submodule by running commands:

bc. sudo apt-get install git
git clone https://github.com/shvid/barclamp-cassandra.git ~/crowbar/barclamps/cassandra
nano ~/crowbar/.gitmodules

Insert text:

bc. [submodule "barclamps/cassandra"]
       path = barclamps/cassandra
       url = git clone https://github.com/shvid/barclamp-cassandra.git

After that you need to build ISO that will contain barclamp_cassandra and all dependencies needed for it. Crowbar will automatically download packages and put them to ISO.

bc. cd ~/crowbar
./build_crowbar.sh ubuntu-12.04 --update-cache

**2. Crowbar Installation**

In this step, please, select how you will install Crowbar on machines.
DELL Crowbar needs as minimum one machine for Admin node and some machines for working nodes.
You could use KVM for virtualization in case of having one physical machine.
In this case please define interfaces like this:

bc.. # The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
auto eth0
iface eth0 inet manual
        up ifconfig $IFACE 0.0.0.0 up
        up ifconfig $IFACE promisc

auto eth1
iface eth1 inet manual
        up ifconfig $IFACE 0.0.0.0 up
        up ifconfig $IFACE promisc

auto br0
iface br0 inet dhcp
        bridge_ports eth0
        bridge_fd 9
        bridge_hello 2
        bridge_maxage 12
        bridge_stp off
      
bc. 
 
And after that you could up KVM machines by using "test_framework":https://github.com/dellcloudedge/crowbar/tree/master/test_framework that is a part of the Crowbar. In this case run this command:

bc. cd ~/crowbar
./test_framework/test_crowbar.sh single cassandra pause develop-mode use-iso crowbar-v1.3-openstack-78-g82f8aaf-dev.iso
 
Your ISO name could be different, the command "./build_crowbar.sh ubuntu-12.04 --update-cache" will show you the exact name. 
 
In case, if you are going to install Crowbar on pool of physical machines, please, take a look in to this "article":https://github.com/dellcloudedge/crowbar/wiki/Install-crowbar.

**3. Cassandra Installation**

In case if previous steps passed successfully you will have installed barclamp_cassandra in your Admin node. Select from barclamps Cassandra and create proposal.

!{width: 1000px;}/images/2012-10-19/1.jpg! 

Click the link "Cassandra" and then you will see proposal creation button.

!{width: 1000px;}/images/2012-10-19/2.jpg! 

Click the button "Create" and you will see the page with settings for Cassandra proposal.

!{width: 1000px;}/images/2012-10-19/3.jpg! 

The most important setting is "Cluster Name". By default it has "Test Cluster" value that it is better to change in fist time. Cluster Name is the Cassandra database name and join name for nodes. This name is important in case if you have couple of Cassandra clusters in same network. Later if you change this name, barclamp Cassandra will remove all data assosiated with previous cluster name, because new nodes can not use persistent data with another cluster name. This about cluster name in same way like database name in RDBMS systems.

Other important settings are: 
 - Storage Port
 - SSL Storage Port
 - RPC Port
 - JMX Port
 
All those settings are important for port customization. Storage Port and SSL Storage Port bing only to admin interface that in Crowbar is 192.168.124.0 for the purpose to be used only by Cassandra nodes. RPC and JMX Ports bind on 0.0.0.0 address to all interfaces in order to get access from Thrift external programs and JMX manage utils.

Data directories settings are used to palace Cassandra data to other HDD drives and storages:
 - Saved Caches Directory
 - Commitlog Directory
 - Data File Directories

The last setting "Data File Directories" could have comma separated directories.

All rest settings used by Cassandra in order to customize data management and to change default settings.

At the end of the proposal edit page we need to select machines where we will install Cassandra.
 
!{width: 1000px;}/images/2012-10-19/4.jpg! 

This is a drag-n-drop interface and we could use mouse to add/remove machines for the role cassandra-server from left pool of the machines.

At the end of the editing process we need to click "Apply" button and we will see success message.

!{width: 1000px;}/images/2012-10-19/5.jpg! 

Cassandra installed by Crowbar.

**4. Cassandra installed**

After Cassandra installation you cloud go to the first node machine where Cassandra has been installed and run

bc. nodetool ring 

This command will show you the Cassandra ring of the nodes. The initial_tokens are calculated by barclamp_cassandra by using this program:

bc.. 

#!/usr/bin/env ruby

if ARGV.size >= 1 then
    num=ARGV[0].to_i
else
    print "How many nodes are in your cluster? "
    num = gets.to_i
end

exit if num == 0

(0..num).each do |i|
    t = i * (2**127) / num
    print "token " + i.to_s + ": " + t.to_s + "\n"
end

p. 

In case if you will add new nodes by editing proposal the barclamp_cassandra will recalculate initial_tokens only in case of new Cluster Name. In other cases barclamp_cassandra will use empty initial_tokens and initialize them from persistent data on directories.

Make sure that for new cluster name barclamp_cassandra will remove all data directories "Saved Caches Directory, Commitlog Directory, Data File Directories" by command
"rm -rf *" in order to have clear space for new cluster, all old data will be lost

