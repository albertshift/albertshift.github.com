#
# Generated by Chef for <%= @node[:fqdn] %>
#
# Copyright 2012, Alex Shvid.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

server {
        listen   80;
        server_name  <%= @forward['hostnames'] %>;

        access_log  <%= node['nginx']['log_dir'] %>/<%= @forward['site'] %>.access.log;
        error_log   <%= node['nginx']['log_dir'] %>/<%= @forward['site'] %>.error.log;

        location / {

            proxy_pass         <%= @forward['url'] %>;
            proxy_redirect     off;

            proxy_set_header   Host             $host;
            proxy_set_header   X-Real-IP        $remote_addr;
            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;

            client_max_body_size       10m;
            client_body_buffer_size    128k;

            charset  utf-8;
        }

        # redirect server not found pages to the static page /404.html
        #
        error_page  404  /404.html;
        location = /404.html {
                root   /var/www/nginx-default;
        }

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
                root   /var/www/nginx-default;
        }

}


